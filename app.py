import streamlit as st
import google.generativeai as genai
import os

# ----------------------------
# APIã‚­ãƒ¼ã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
# ----------------------------
GOOGLE_API_KEY = os.environ.get("GOOGLE_API_KEY")

if not GOOGLE_API_KEY:
    st.error("Google Gemini APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
    st.stop()

genai.configure(api_key=GOOGLE_API_KEY)

# ----------------------------
# ãƒ¢ãƒ‡ãƒ«è¨­å®š
# ----------------------------
model = genai.GenerativeModel("gemini-2.0-flash")

# ----------------------------
# ãƒšãƒ¼ã‚¸è¨­å®š
# ----------------------------
st.set_page_config(
    page_title="çŒ®ç«‹ææ¡ˆAIã‚¢ãƒ—ãƒª",
    page_icon="ğŸ½ï¸",
    layout="wide"
)

st.title("çŒ®ç«‹ææ¡ˆAIã‚¢ãƒ—ãƒª ğŸ½ï¸")
st.write("æ¡ä»¶ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€æ•°æ—¥åˆ†ã®çŒ®ç«‹ã¨è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚’ææ¡ˆã—ã¾ã™ã€‚")

# ----------------------------
# å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
# ----------------------------
with st.form("menu_form"):

    col1, col2 = st.columns(2)

    with col1:
        ç”¨é€” = st.text_input("ä½¿ç”¨ç”¨é€”ï¼ˆä¾‹ï¼šæ™©ã”é£¯ / å¼å½“ç”¨ï¼‰")
        æ—¥æ•° = st.number_input("å¿…è¦ãªæ—¥æ•°", 1, 7, 3)
        é£Ÿæ = st.text_input("ä½¿ã„ãŸã„é£Ÿæï¼ˆä»»æ„ï¼‰")

    with col2:
        åˆ¶é™ = st.text_input("é¿ã‘ãŸã„é£Ÿæï¼ˆä»»æ„ï¼‰")
        è¦æœ› = st.text_input("è¦æœ›ï¼ˆç°¡å˜ãƒ»ç¯€ç´„ãƒ»é«˜ã‚¿ãƒ³ãƒ‘ã‚¯ãªã©ï¼‰")
        ãã®ä»– = st.text_input("ãã®ä»–ã®å¸Œæœ›ï¼ˆä»»æ„ï¼‰")

    submitted = st.form_submit_button("çŒ®ç«‹ã‚’ææ¡ˆã™ã‚‹ ğŸ³")

# ----------------------------
# Geminiç”Ÿæˆ
# ----------------------------
if submitted:

    with st.spinner("çŒ®ç«‹ã‚’è€ƒãˆã¦ã„ã¾ã™... ğŸ³"):

        prompt = f"""
ã‚ãªãŸã¯ç®¡ç†æ „é¤Šå£«ã§ã™ã€‚
ä»¥ä¸‹ã®æ¡ä»¶ã§{æ—¥æ•°}æ—¥åˆ†ã®çŒ®ç«‹ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ã€ç”¨é€”ã€‘{ç”¨é€”}
ã€ä½¿ã„ãŸã„é£Ÿæã€‘{é£Ÿæ or "ç‰¹ã«ãªã—"}
ã€é¿ã‘ãŸã„é£Ÿæã€‘{åˆ¶é™ or "ç‰¹ã«ãªã—"}
ã€è¦æœ›ã€‘{è¦æœ› or "ç‰¹ã«ãªã—"}
ã€ãã®ä»–ã€‘{ãã®ä»– or "ç‰¹ã«ãªã—"}

å‡ºåŠ›å½¢å¼ï¼š
1. æ—¥ã”ã¨ã®çŒ®ç«‹
2. ç°¡å˜ãªãƒ¬ã‚·ãƒ”
3. å¿…è¦ãªé£Ÿæãƒªã‚¹ãƒˆï¼ˆã¾ã¨ã‚ï¼‰
"""

        try:
            response = model.generate_content(prompt)

            st.subheader("ğŸ“‹ ææ¡ˆã•ã‚ŒãŸçŒ®ç«‹")
            st.write(response.text)

        except Exception as e:
            st.error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
            st.write(e)
